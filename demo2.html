<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>BillFlow - RWA Invoice Factoring</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .tab-active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }
        .risk-A { border-left: 4px solid #10b981; }
        .risk-B { border-left: 4px solid #f59e0b; }
        .risk-C { border-left: 4px solid #ef4444; }
        .risk-badge-A { background-color: #10b981; color: white; }
        .risk-badge-B { background-color: #f59e0b; color: white; }
        .risk-badge-C { background-color: #ef4444; color: white; }
    </style>
</head>
<body class="bg-slate-100 h-screen flex items-center justify-center font-sans">

    <div class="bg-white p-8 rounded-2xl shadow-2xl w-[1000px] relative">
        
        <div class="absolute top-8 right-8">
            <button onclick="toggleLanguage()" 
                    class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-full border border-gray-300 flex items-center gap-2 transition">
                <span id="langIcon">üáªüá≥</span> 
                <span id="langText">Ti·∫øng Vi·ªát</span>
            </button>
        </div>

        <div class="flex justify-between items-center mb-8 border-b pb-4">
            <div>
                <h1 class="text-3xl font-extrabold text-blue-700 flex items-center gap-3">
                    <i class="fa-solid fa-money-bill-transfer"></i> BillFlow
                </h1>
                <p class="text-gray-500 mt-1" id="subtitle">N·ªÅn t·∫£ng thanh kho·∫£n h√≥a ƒë∆°n cho SME (RWA)</p>
            </div>
        </div>

        <!-- TABS SYSTEM -->
        <div class="flex mb-6 border-b">
            <button id="tabBorrower" onclick="switchTab('borrower')" 
                    class="tab-active py-3 px-6 rounded-t-lg transition-all duration-300">
                <i class="fa-solid fa-building mr-2"></i>
                <span id="tabBorrowerText">Ng∆∞·ªùi Vay (SME)</span>
            </button>
            <button id="tabLender" onclick="switchTab('lender')" 
                    class="py-3 px-6 rounded-t-lg text-gray-600 hover:text-blue-600 transition-all duration-300">
                <i class="fa-solid fa-chart-line mr-2"></i>
                <span id="tabLenderText">Ng∆∞·ªùi Cho Vay (Investor)</span>
            </button>
        </div>

        <!-- BORROWER TAB (HI·ªÜN T·∫†I) -->
        <div id="borrowerContent" class="space-y-6">
            <div class="grid grid-cols-2 gap-8">
                
                <div class="space-y-5">
                    <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-2 rounded-lg text-sm font-semibold flex items-center">
                        <span class="mr-2">‚óè</span> <span id="walletText">ƒê√£ k·∫øt n·ªëi v√≠:</span> 0x98...A12
                    </div>

                    <!-- TH√îNG TIN DOANH NGHI·ªÜP (M·ªöI) -->
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <h3 class="font-bold text-blue-800 mb-3 flex items-center">
                            <i class="fa-solid fa-building-shield mr-2"></i>
                            <span id="businessInfoTitle">Th√¥ng tin Doanh nghi·ªáp</span>
                        </h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-sm text-gray-600" id="labelBusinessAge">Th·ªùi gian ho·∫°t ƒë·ªông</label>
                                <select id="businessAge" class="w-full p-2 border rounded mt-1">
                                    <option value="3">D∆∞·ªõi 6 th√°ng</option>
                                    <option value="5">6-12 th√°ng</option>
                                    <option value="7" selected>1-2 nƒÉm</option>
                                    <option value="10">Tr√™n 2 nƒÉm</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600" id="labelIndustry">Ng√†nh ngh·ªÅ</label>
                                <select id="industry" class="w-full p-2 border rounded mt-1">
                                    <option value="10" selected>C√¥ng ngh·ªá</option>
                                    <option value="7">Th∆∞∆°ng m·∫°i</option>
                                    <option value="5">S·∫£n xu·∫•t</option>
                                    <option value="3">X√¢y d·ª±ng</option>
                                </select>
                            </div>
                            <div class="col-span-2">
                                <div class="flex items-center gap-2 mb-2">
                                    <input type="checkbox" id="isKYC" checked>
                                    <label for="isKYC" class="text-sm" id="labelKYC">ƒê√£ x√°c minh KYC</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <input type="checkbox" id="hasHistory">
                                    <label for="hasHistory" class="text-sm" id="labelHistory">C√≥ l·ªãch s·ª≠ vay tr∆∞·ªõc</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- K·∫æT QU·∫¢ RISK SCORING (M·ªöI) -->
                    <div id="riskResult" class="hidden bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-blue-800" id="riskResultTitle">K·∫øt qu·∫£ ƒë√°nh gi√° r·ªßi ro</h4>
                            <span id="riskBadge" class="px-3 py-1 rounded-full text-sm font-bold risk-badge-B">H·∫°ng B</span>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600" id="labelLTV">T·ª∑ l·ªá cho vay (LTV):</span>
                                <span id="ltvValue" class="font-bold text-blue-700 ml-2">70%</span>
                            </div>
                            <div>
                                <span class="text-gray-600" id="labelServiceFee">Ph√≠ d·ªãch v·ª•:</span>
                                <span id="serviceFee" class="font-bold text-red-600 ml-2">2.0%</span>
                            </div>
                            <div class="col-span-2">
                                <span class="text-gray-600" id="labelRiskScore">ƒêi·ªÉm t√≠n d·ª•ng:</span>
                                <div class="flex items-center gap-2 mt-1">
                                    <div class="flex-1 bg-gray-200 rounded-full h-2">
                                        <div id="riskBar" class="bg-green-500 h-2 rounded-full w-3/4"></div>
                                    </div>
                                    <span id="riskScore" class="font-bold">72/100</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NH·∫¨P H√ìA ƒê∆†N -->
                    <div class="bg-blue-50 p-5 rounded-xl border border-blue-100">
                        <label class="block text-gray-700 font-bold mb-2" id="labelAmount">Gi√° tr·ªã h√≥a ƒë∆°n (USDT)</label>
                        <input type="number" id="amount" placeholder="V√≠ d·ª•: 10000" 
                              
                               class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-lg">
                    </div>
                    
                    <!-- BUTTONS -->
                    <button onclick="calculateRisk()" class="w-full bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-xl font-bold transition shadow-lg flex items-center justify-center gap-2">
                        <i class="fa-solid fa-calculator"></i> 
                        <span id="btnCalculate">T√≠nh to√°n r·ªßi ro & LTV</span>
                    </button>

                    <button onclick="step1()" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-xl font-bold transition shadow-lg flex items-center justify-center gap-2">
                        <i class="fa-solid fa-file-contract"></i> 
                        <span id="btnMint">1. M√£ h√≥a H√≥a ƒë∆°n (Mint NFT)</span>
                    </button>
                    
                    <button onclick="step2()" class="w-full bg-green-600 hover:bg-green-700 text-white p-4 rounded-xl font-bold transition shadow-lg flex items-center justify-center gap-2">
                        <i class="fa-solid fa-hand-holding-dollar"></i>
                        <span id="btnBorrow">2. Th·∫ø ch·∫•p & Vay ti·ªÅn</span>
                    </button>
                </div>

                <!-- LOG CONSOLE -->
                <div class="flex flex-col h-full">
                    <div class="bg-gray-900 text-green-400 p-5 rounded-xl font-mono text-sm flex-1 overflow-y-auto shadow-inner" id="logs">
                        > System ready...<br>
                        > Connecting to Smart Contract...<br>
                        > Connected to Sepolia Testnet.<br>
                        > Risk model loaded successfully.<br>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 text-center" id="footerText">Powered by Ethereum Blockchain</p>
                </div>
            </div>
        </div>

        <!-- LENDER TAB (M·ªöI) -->
        <div id="lenderContent" class="hidden">
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4 mb-6">
                <h3 class="font-bold text-green-800 mb-2 flex items-center">
                    <i class="fa-solid fa-lightbulb mr-2"></i>
                    <span id="lenderWelcomeTitle">Ch√†o m·ª´ng Nh√† ƒë·∫ßu t∆∞!</span>
                </h3>
                <p class="text-sm text-gray-700" id="lenderWelcomeText">
                    ƒê·∫ßu t∆∞ v√†o h√≥a ƒë∆°n SME ƒë·ªÉ nh·∫≠n l·ª£i nhu·∫≠n c·ªë ƒë·ªãnh. R·ªßi ro cao = l·ª£i nhu·∫≠n cao.
                </p>
            </div>

            <!-- V√ç ƒê·∫¶U T∆Ø -->
            <div class="grid grid-cols-3 gap-6 mb-6">
                <div class="bg-white border rounded-xl p-4 shadow">
                    <div class="text-gray-500 text-sm" id="labelWalletBalance">S·ªë d∆∞ v√≠</div>
                    <div class="text-2xl font-bold text-green-600">25,000 <span class="text-lg">USDT</span></div>
                </div>
                <div class="bg-white border rounded-xl p-4 shadow">
                    <div class="text-gray-500 text-sm" id="labelInvestedAmount">ƒê√£ ƒë·∫ßu t∆∞</div>
                    <div class="text-2xl font-bold text-blue-600">12,500 <span class="text-lg">USDT</span></div>
                </div>
                <div class="bg-white border rounded-xl p-4 shadow">
                    <div class="text-gray-500 text-sm" id="labelAvgAPY">L·ª£i nhu·∫≠n trung b√¨nh</div>
                    <div class="text-2xl font-bold text-purple-600">9.2<span class="text-lg">% APY</span></div>
                </div>
            </div>

            <!-- MARKETPLACE -->
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <i class="fa-solid fa-store mr-2"></i>
                <span id="marketplaceTitle">Marketplace - H√≥a ƒë∆°n ƒëang ch·ªù ƒë·∫ßu t∆∞</span>
            </h3>

            <!-- FILTERS -->
            <div class="flex gap-4 mb-6">
                <select id="filterRisk" class="border rounded-lg p-2 text-sm" onchange="filterInvoices()">
                    <option value="all" id="filterAll">T·∫•t c·∫£ r·ªßi ro</option>
                    <option value="A" id="filterRiskA">R·ªßi ro th·∫•p (A)</option>
                    <option value="B" selected id="filterRiskB">R·ªßi ro trung b√¨nh (B)</option>
                    <option value="C" id="filterRiskC">R·ªßi ro cao (C)</option>
                </select>
                <select id="filterAPY" class="border rounded-lg p-2 text-sm" onchange="filterInvoices()">
                    <option value="all" id="filterAllAPY">T·∫•t c·∫£ l·ª£i nhu·∫≠n</option>
                    <option value="6-8" id="filterLowAPY">6-8% APY</option>
                    <option value="8-10" selected id="filterMedAPY">8-10% APY</option>
                    <option value="10-12" id="filterHighAPY">10-12% APY</option>
                </select>
            </div>

            <!-- INVOICE LISTINGS -->
            <div id="invoiceListings" class="grid grid-cols-2 gap-4">
                <!-- C√°c invoice s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
            </div>

            <!-- INVESTMENT HISTORY -->
            <div class="mt-8">
                <h4 class="font-bold mb-3 text-gray-700 flex items-center">
                    <i class="fa-solid fa-history mr-2"></i>
                    <span id="historyTitle">L·ªãch s·ª≠ ƒë·∫ßu t∆∞ c·ªßa b·∫°n</span>
                </h4>
                <div class="bg-gray-50 border rounded-lg p-4">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-2 text-left" id="thInvoice">H√≥a ƒë∆°n</th>
                                    <th class="p-2 text-left" id="thAmount">S·ªë ti·ªÅn</th>
                                    <th class="p-2 text-left" id="thAPY">L·ª£i nhu·∫≠n</th>
                                    <th class="p-2 text-left" id="thStatus">Tr·∫°ng th√°i</th>
                                </tr>
                            </thead>
                            <tbody id="investmentHistory">
                                <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // ==================== C·∫§U H√åNH BI·∫æN S·ªê ====================
    let isVietnamese = true;
    let currentNftId = 1024;
    let currentTab = 'borrower';
    let currentRiskScore = 72;
    let currentLTV = 0.70;
    let currentFee = 2.0;
    
    // D·ªØ li·ªáu gi·∫£ cho Marketplace
    const marketplaceInvoices = [
        {
            id: 1001,
            business: "TechCorp VN",
            amount: 15000,
            risk: "A",
            apy: 7.5,
            term: 60,
            funded: 65,
            kyc: true,
            description: "H√≥a ƒë∆°n ph·∫ßn m·ªÅm cho FPT"
        },
        {
            id: 1002,
            business: "X√¢y d·ª±ng Minh Anh",
            amount: 25000,
            risk: "C",
            apy: 11.2,
            term: 90,
            funded: 30,
            kyc: true,
            description: "H√≥a ƒë∆°n v·∫≠t li·ªáu x√¢y d·ª±ng"
        },
        {
            id: 1003,
            business: "Th·ª±c ph·∫©m S·∫°ch",
            amount: 8000,
            risk: "B",
            apy: 8.8,
            term: 45,
            funded: 80,
            kyc: true,
            description: "H√≥a ƒë∆°n cung c·∫•p th·ª±c ph·∫©m"
        },
        {
            id: 1004,
            business: "LogiTech Solutions",
            amount: 12000,
            risk: "A",
            apy: 6.9,
            term: 30,
            funded: 95,
            kyc: true,
            description: "H√≥a ƒë∆°n d·ªãch v·ª• logistics"
        }
    ];

    // L·ªãch s·ª≠ ƒë·∫ßu t∆∞ gi·∫£
    const investmentHistory = [
        { invoice: "#987", amount: 5000, apy: 8.5, status: "ƒêang ho·∫°t ƒë·ªông" },
        { invoice: "#986", amount: 3000, apy: 7.2, status: "ƒê√£ thanh to√°n" },
        { invoice: "#985", amount: 7500, apy: 10.1, status: "ƒêang ho·∫°t ƒë·ªông" }
    ];

    // ==================== T·ª™ ƒêI·ªÇN ƒêA NG√îN NG·ªÆ ====================
    const content = {
        vi: {
            // Borrower tab
            subtitle: "N·ªÅn t·∫£ng thanh kho·∫£n h√≥a ƒë∆°n cho SME (RWA)",
            wallet: "ƒê√£ k·∫øt n·ªëi v√≠:",
            businessInfoTitle: "Th√¥ng tin Doanh nghi·ªáp",
            labelBusinessAge: "Th·ªùi gian ho·∫°t ƒë·ªông",
            labelIndustry: "Ng√†nh ngh·ªÅ",
            labelKYC: "ƒê√£ x√°c minh KYC",
            labelHistory: "C√≥ l·ªãch s·ª≠ vay tr∆∞·ªõc",
            riskResultTitle: "K·∫øt qu·∫£ ƒë√°nh gi√° r·ªßi ro",
            labelLTV: "T·ª∑ l·ªá cho vay (LTV):",
            labelServiceFee: "Ph√≠ d·ªãch v·ª•:",
            labelRiskScore: "ƒêi·ªÉm t√≠n d·ª•ng:",
            labelAmount: "Gi√° tr·ªã h√≥a ƒë∆°n (USDT)",
            btnCalculate: "T√≠nh to√°n r·ªßi ro & LTV",
            btnMint: "1. M√£ h√≥a H√≥a ƒë∆°n (Mint NFT)",
            btnBorrow: "2. Th·∫ø ch·∫•p & Vay ti·ªÅn",
            
            // Lender tab
            tabBorrowerText: "Ng∆∞·ªùi Vay (SME)",
            tabLenderText: "Ng∆∞·ªùi Cho Vay (Investor)",
            lenderWelcomeTitle: "Ch√†o m·ª´ng Nh√† ƒë·∫ßu t∆∞!",
            lenderWelcomeText: "ƒê·∫ßu t∆∞ v√†o h√≥a ƒë∆°n SME ƒë·ªÉ nh·∫≠n l·ª£i nhu·∫≠n c·ªë ƒë·ªãnh. R·ªßi ro cao = l·ª£i nhu·∫≠n cao.",
            labelWalletBalance: "S·ªë d∆∞ v√≠",
            labelInvestedAmount: "ƒê√£ ƒë·∫ßu t∆∞",
            labelAvgAPY: "L·ª£i nhu·∫≠n trung b√¨nh",
            marketplaceTitle: "Marketplace - H√≥a ƒë∆°n ƒëang ch·ªù ƒë·∫ßu t∆∞",
            filterAll: "T·∫•t c·∫£ r·ªßi ro",
            filterRiskA: "R·ªßi ro th·∫•p (A)",
            filterRiskB: "R·ªßi ro trung b√¨nh (B)",
            filterRiskC: "R·ªßi ro cao (C)",
            filterAllAPY: "T·∫•t c·∫£ l·ª£i nhu·∫≠n",
            filterLowAPY: "6-8% APY",
            filterMedAPY: "8-10% APY",
            filterHighAPY: "10-12% APY",
            historyTitle: "L·ªãch s·ª≠ ƒë·∫ßu t∆∞ c·ªßa b·∫°n",
            thInvoice: "H√≥a ƒë∆°n",
            thAmount: "S·ªë ti·ªÅn",
            thAPY: "L·ª£i nhu·∫≠n",
            thStatus: "Tr·∫°ng th√°i",
            
            // Common
            langBtn: "Ti·∫øng Vi·ªát",
            alertInput: "Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn!",
            alertMint_Pre: "Th√†nh c√¥ng! ƒê√£ t·∫°o NFT #",
            alertMint_Suf: " cho h√≥a ƒë∆°n tr·ªã gi√° $",
            alertLoan_Pre: "ƒê√£ gi·∫£i ng√¢n ",
            alertLoan_Suf: " USDT v·ªÅ v√≠ c·ªßa b·∫°n!",
            logMint_Pre: "[MINT SUCCESS] ƒê√£ t·∫°o NFT #", 
            logMint_Suf: ". ƒê·ªãnh gi√°: $",
            logLoan_Pre: "[COLLATERAL] NFT #",
            logLoan_Suf: " ƒë√£ kh√≥a. LTV: ",
            logTransfer_Pre: "[TRANSFER] ƒê√£ chuy·ªÉn ",
            logTransfer_Suf: " USDT v·ªÅ v√≠ ng∆∞·ªùi d√πng."
        },
        en: {
            // Borrower tab
            subtitle: "Decentralized Invoice Factoring Protocol (RWA)",
            wallet: "Wallet Connected:",
            businessInfoTitle: "Business Information",
            labelBusinessAge: "Business Age",
            labelIndustry: "Industry",
            labelKYC: "KYC Verified",
            labelHistory: "Has borrowing history",
            riskResultTitle: "Risk Assessment Result",
            labelLTV: "Loan-to-Value (LTV):",
            labelServiceFee: "Service Fee:",
            labelRiskScore: "Credit Score:",
            labelAmount: "Invoice Value (USDT)",
            btnCalculate: "Calculate Risk & LTV",
            btnMint: "1. Tokenize Invoice (Mint NFT)",
            btnBorrow: "2. Collateralize & Borrow",
            
            // Lender tab
            tabBorrowerText: "Borrower (SME)",
            tabLenderText: "Lender (Investor)",
            lenderWelcomeTitle: "Welcome Investor!",
            lenderWelcomeText: "Invest in SME invoices for fixed returns. Higher risk = higher reward.",
            labelWalletBalance: "Wallet Balance",
            labelInvestedAmount: "Total Invested",
            labelAvgAPY: "Average Returns",
            marketplaceTitle: "Marketplace - Invoices Available for Investment",
            filterAll: "All Risk Levels",
            filterRiskA: "Low Risk (A)",
            filterRiskB: "Medium Risk (B)",
            filterRiskC: "High Risk (C)",
            filterAllAPY: "All Returns",
            filterLowAPY: "6-8% APY",
            filterMedAPY: "8-10% APY",
            filterHighAPY: "10-12% APY",
            historyTitle: "Your Investment History",
            thInvoice: "Invoice",
            thAmount: "Amount",
            thAPY: "APY",
            thStatus: "Status",
            
            // Common
            langBtn: "English",
            alertInput: "Please enter the amount!",
            alertMint_Pre: "Success! Minted NFT #",
            alertMint_Suf: " for invoice value $",
            alertLoan_Pre: "Disbursed ",
            alertLoan_Suf: " USDT to your wallet!",
            logMint_Pre: "[MINT SUCCESS] Created NFT #",
            logMint_Suf: ". Valuation: $",
            logLoan_Pre: "[COLLATERAL] NFT #",
            logLoan_Suf: " locked. LTV: ",
            logTransfer_Pre: "[TRANSFER] Sent ",
            logTransfer_Suf: " USDT to user wallet."
        }
    };

    // ==================== H√ÄM CH√çNH ====================

    function toggleLanguage() {
        isVietnamese = !isVietnamese;
        const lang = isVietnamese ? content.vi : content.en;
        
        // C·∫≠p nh·∫≠t text tƒ©nh
        document.getElementById('subtitle').innerText = lang.subtitle;
        document.getElementById('walletText').innerText = lang.wallet;
        document.getElementById('businessInfoTitle').innerText = lang.businessInfoTitle;
        document.getElementById('labelBusinessAge').innerText = lang.labelBusinessAge;
        document.getElementById('labelIndustry').innerText = lang.labelIndustry;
        document.getElementById('labelKYC').innerText = lang.labelKYC;
        document.getElementById('labelHistory').innerText = lang.labelHistory;
        document.getElementById('riskResultTitle').innerText = lang.riskResultTitle;
        document.getElementById('labelLTV').innerText = lang.labelLTV;
        document.getElementById('labelServiceFee').innerText = lang.labelServiceFee;
        document.getElementById('labelRiskScore').innerText = lang.labelRiskScore;
        document.getElementById('labelAmount').innerText = lang.labelAmount;
        document.getElementById('btnCalculate').innerText = lang.btnCalculate;
        document.getElementById('btnMint').innerText = lang.btnMint;
        document.getElementById('btnBorrow').innerText = lang.btnBorrow;
        document.getElementById('tabBorrowerText').innerText = lang.tabBorrowerText;
        document.getElementById('tabLenderText').innerText = lang.tabLenderText;
        document.getElementById('langText').innerText = lang.langBtn;
        document.getElementById('langIcon').innerText = isVietnamese ? "üáªüá≥" : "üá¨üáß";
        
        // C·∫≠p nh·∫≠t lender tab
        document.getElementById('lenderWelcomeTitle').innerText = lang.lenderWelcomeTitle;
        document.getElementById('lenderWelcomeText').innerText = lang.lenderWelcomeText;
        document.getElementById('labelWalletBalance').innerText = lang.labelWalletBalance;
        document.getElementById('labelInvestedAmount').innerText = lang.labelInvestedAmount;
        document.getElementById('labelAvgAPY').innerText = lang.labelAvgAPY;
        document.getElementById('marketplaceTitle').innerText = lang.marketplaceTitle;
        document.getElementById('filterAll').innerText = lang.filterAll;
        document.getElementById('filterRiskA').innerText = lang.filterRiskA;
        document.getElementById('filterRiskB').innerText = lang.filterRiskB;
        document.getElementById('filterRiskC').innerText = lang.filterRiskC;
        document.getElementById('filterAllAPY').innerText = lang.filterAllAPY;
        document.getElementById('filterLowAPY').innerText = lang.filterLowAPY;
        document.getElementById('filterMedAPY').innerText = lang.filterMedAPY;
        document.getElementById('filterHighAPY').innerText = lang.filterHighAPY;
        document.getElementById('historyTitle').innerText = lang.historyTitle;
        document.getElementById('thInvoice').innerText = lang.thInvoice;
        document.getElementById('thAmount').innerText = lang.thAmount;
        document.getElementById('thAPY').innerText = lang.thAPY;
        document.getElementById('thStatus').innerText = lang.thStatus;
        
        // C·∫≠p nh·∫≠t marketplace v√† history
        renderMarketplace();
        renderInvestmentHistory();
    }

    function switchTab(tab) {
        currentTab = tab;
        
        // C·∫≠p nh·∫≠t UI tab
        document.getElementById('tabBorrower').classList.remove('tab-active');
        document.getElementById('tabBorrower').classList.add('text-gray-600');
        document.getElementById('tabLender').classList.remove('tab-active');
        document.getElementById('tabLender').classList.add('text-gray-600');
        
        document.getElementById('tabBorrower').classList.add('hover:text-blue-600');
        document.getElementById('tabLender').classList.add('hover:text-blue-600');
        
        // ·∫®n t·∫•t c·∫£ content
        document.getElementById('borrowerContent').classList.add('hidden');
        document.getElementById('lenderContent').classList.add('hidden');
        
        // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
        document.getElementById(tab + 'Content').classList.remove('hidden');
        document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('tab-active');
        document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('text-gray-600');
        document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('hover:text-blue-600');
        
        // N·∫øu l√† lender tab, render marketplace
        if (tab === 'lender') {
            renderMarketplace();
            renderInvestmentHistory();
        }
    }

    function calculateRisk() {
        const amount = document.getElementById('amount').value;
        if (!amount) return;
        
        // T√≠nh ƒëi·ªÉm t·ª´ form
        let score = 50; // ƒêi·ªÉm c∆° b·∫£n
        
        // Th·ªùi gian ho·∫°t ƒë·ªông
        const businessAgeScore = parseInt(document.getElementById('businessAge').value);
        score += businessAgeScore;
        
        // Ng√†nh ngh·ªÅ
        const industryScore = parseInt(document.getElementById('industry').value);
        score += industryScore;
        
        // KYC verification
        if (document.getElementById('isKYC').checked) {
            score += 15;
        }
        
        // L·ªãch s·ª≠ vay
        if (document.getElementById('hasHistory').checked) {
            score += 10;
        }
        
        // ƒêi·ªÅu ch·ªânh theo s·ªë ti·ªÅn
        const amountNum = parseFloat(amount);
        if (amountNum > 50000) score -= 20;
        else if (amountNum > 20000) score -= 10;
        else if (amountNum < 5000) score += 5;
        
        // Gi·ªõi h·∫°n ƒëi·ªÉm 10-100
        score = Math.max(10, Math.min(100, score));
        currentRiskScore = score;
        
        // X√°c ƒë·ªãnh risk grade, LTV v√† ph√≠
        let riskGrade, ltv, fee;
        if (score >= 80) {
            riskGrade = "A";
            ltv = 0.75;
            fee = 1.5;
        } else if (score >= 60) {
            riskGrade = "B";
            ltv = 0.70;
            fee = 2.0;
        } else if (score >= 40) {
            riskGrade = "C";
            ltv = 0.60;
            fee = 2.5;
        } else {
            riskGrade = "D";
            ltv = 0.40;
            fee = 3.5;
        }
        
        currentLTV = ltv;
        currentFee = fee;
        
        // C·∫≠p nh·∫≠t UI
        document.getElementById('riskResult').classList.remove('hidden');
        document.getElementById('riskBadge').innerText = riskGrade;
        document.getElementById('riskBadge').className = `px-3 py-1 rounded-full text-sm font-bold risk-badge-${riskGrade}`;
        document.getElementById('ltvValue').innerText = `${(ltv * 100).toFixed(0)}%`;
        document.getElementById('serviceFee').innerText = `${fee}%`;
        document.getElementById('riskScore').innerText = `${score}/100`;
        document.getElementById('riskBar').style.width = `${score}%`;
        
        // ƒê·ªïi m√†u risk bar
        if (score >= 80) {
            document.getElementById('riskBar').className = "bg-green-500 h-2 rounded-full";
        } else if (score >= 60) {
            document.getElementById('riskBar').className = "bg-yellow-500 h-2 rounded-full";
        } else {
            document.getElementById('riskBar').className = "bg-red-500 h-2 rounded-full";
        }
        
        log(`[RISK] Business scored ${score}/100 ‚Üí Grade ${riskGrade}, LTV ${(ltv*100)}%, Fee ${fee}%`);
    }

    function log(text) {
        const box = document.getElementById('logs');
        box.innerHTML += `> ${text}<br>`;
        box.scrollTop = box.scrollHeight;
    }

    function step1() {
        const lang = isVietnamese ? content.vi : content.en;
        const val = document.getElementById('amount').value;
        if(!val) { alert(lang.alertInput); return; }
        
        currentNftId++; 

        document.body.style.cursor = 'wait';
        setTimeout(() => {
            alert(lang.alertMint_Pre + currentNftId + lang.alertMint_Suf + val);
            log(lang.logMint_Pre + currentNftId + lang.logMint_Suf + val);
            log(`[RISK] This invoice is Grade ${document.getElementById('riskBadge').innerText}`);
            document.body.style.cursor = 'default';
        }, 800);
    }

    function step2() {
        const lang = isVietnamese ? content.vi : content.en;
        const val = document.getElementById('amount').value;
        if(!val) { alert(lang.alertInput); return; }

        // T√≠nh to√°n d·ª±a tr√™n LTV t·ª´ risk model
        const loanAmount = (val * currentLTV).toFixed(0);
        const randomHash = generateTxHash();

        document.body.style.cursor = 'wait';
        setTimeout(() => {
            alert(`${lang.alertLoan_Pre}${loanAmount}${lang.alertLoan_Suf} (${(currentLTV*100)}% LTV)`);
            
            log(lang.logLoan_Pre + currentNftId + lang.logLoan_Suf + (currentLTV*100) + "%");
            log(lang.logTransfer_Pre + loanAmount + lang.logTransfer_Suf);
            log(`[DONE] Transaction Hash: ${randomHash}`);
            
            document.body.style.cursor = 'default';
        }, 1000);
    }

    function generateTxHash() {
        const chars = "0123456789ABCDEF";
        let hash = "0x";
        for (let i = 0; i < 3; i++) hash += chars[Math.floor(Math.random() * 16)];
        hash += "...";
        for (let i = 0; i < 3; i++) hash += chars[Math.floor(Math.random() * 16)];
        return hash;
    }

    // ==================== LENDER FUNCTIONS ====================

    function renderMarketplace() {
        const container = document.getElementById('invoiceListings');
        const riskFilter = document.getElementById('filterRisk').value;
        const apyFilter = document.getElementById('filterAPY').value;
        
        container.innerHTML = '';
        
        const filteredInvoices = marketplaceInvoices.filter(invoice => {
            // L·ªçc theo risk
            if (riskFilter !== 'all' && invoice.risk !== riskFilter) return false;
            
            // L·ªçc theo APY
            if (apyFilter !== 'all') {
                const [min, max] = apyFilter.split('-').map(Number);
                if (invoice.apy < min || invoice.apy > max) return false;
            }
            
            return true;
        });
        
        if (filteredInvoices.length === 0) {
            container.innerHTML = `
                <div class="col-span-2 text-center py-8 text-gray-500">
                    <i class="fa-solid fa-search text-3xl mb-2"></i>
                    <p>Kh√¥ng t√¨m th·∫•y h√≥a ƒë∆°n ph√π h·ª£p v·ªõi b·ªô l·ªçc</p>
                </div>
            `;
            return;
        }
        
        filteredInvoices.forEach(invoice => {
            const card = document.createElement('div');
            card.className = `border rounded-xl p-4 shadow hover:shadow-lg transition risk-${invoice.risk}`;
            
            // T√≠nh to√°n m√†u APY
            let apyColor = "text-green-600";
            if (invoice.apy >= 10) apyColor = "text-red-600";
            else if (invoice.apy >= 8) apyColor = "text-yellow-600";
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <span class="px-2 py-1 rounded text-xs font-bold risk-badge-${invoice.risk}">
                            ${invoice.risk}
                        </span>
                        <span class="ml-2 text-xs text-gray-500">${invoice.kyc ? '‚úÖ KYC' : '‚ö†Ô∏è No KYC'}</span>
                    </div>
                    <div class="text-right">
                        <div class="${apyColor} font-bold text-lg">${invoice.apy}%</div>
                        <div class="text-xs text-gray-500">APY</div>
                    </div>
                </div>
                
                <h4 class="font-bold">H√≥a ƒë∆°n #${invoice.id}</h4>
                <p class="text-sm text-gray-600 mb-2">${invoice.business}</p>
                <p class="text-sm mb-3">${invoice.description}</p>
                
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Gi√° tr·ªã:</span>
                        <span class="font-bold">${invoice.amount.toLocaleString()} USDT</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">K·ª≥ h·∫°n:</span>
                        <span>${invoice.term} ng√†y</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">ƒê√£ g√≥p v·ªën:</span>
                        <span>${invoice.funded}%</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="flex justify-between text-xs mb-1">
                        <span>Ti·∫øn ƒë·ªô g√≥p v·ªën</span>
                        <span>${invoice.funded}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${invoice.funded}%"></div>
                    </div>
                </div>
                
                <button onclick="invest(${invoice.id})" 
                        class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 rounded-lg transition-all">
                    <i class="fa-solid fa-coins mr-2"></i>
                    ${isVietnamese ? 'ƒê·∫¶U T∆Ø NGAY' : 'INVEST NOW'}
                </button>
            `;
            
            container.appendChild(card);
        });
    }

    function renderInvestmentHistory() {
        const container = document.getElementById('investmentHistory');
        container.innerHTML = '';
        
        investmentHistory.forEach(item => {
            const row = document.createElement('tr');
            row.className = 'border-b hover:bg-gray-50';
            
            let statusColor = "text-green-600";
            if (item.status.includes("ƒêang")) statusColor = "text-blue-600";
            if (item.status.includes("Tr·ªÖ")) statusColor = "text-red-600";
            
            row.innerHTML = `
                <td class="p-2 font-medium">${item.invoice}</td>
                <td class="p-2">${item.amount.toLocaleString()} USDT</td>
                <td class="p-2 font-bold text-green-600">${item.apy}% APY</td>
                <td class="p-2 ${statusColor}">${item.status}</td>
            `;
            
            container.appendChild(row);
        });
    }

    function filterInvoices() {
        renderMarketplace();
    }

    function invest(invoiceId) {
        const invoice = marketplaceInvoices.find(i => i.id === invoiceId);
        const lang = isVietnamese ? content.vi : content.en;
        
        const amount = prompt(`${isVietnamese ? 'Nh·∫≠p s·ªë ti·ªÅn ƒë·∫ßu t∆∞ (USDT)' : 'Enter investment amount (USDT)'}:\n\nH√≥a ƒë∆°n #${invoice.id}\nL·ª£i nhu·∫≠n: ${invoice.apy}% APY\nR·ªßi ro: ${invoice.risk}`, "1000");
        
        if (amount && !isNaN(amount) && amount > 0) {
            document.body.style.cursor = 'wait';
            setTimeout(() => {
                alert(`${isVietnamese ? '‚úÖ ƒê·∫ßu t∆∞ th√†nh c√¥ng!' : '‚úÖ Investment successful!'}\n\n${amount} USDT v√†o h√≥a ƒë∆°n #${invoice.id}\nL·ª£i nhu·∫≠n d·ª± ki·∫øn: ${(amount * invoice.apy / 100).toFixed(2)} USDT/nƒÉm`);
                
                // Th√™m v√†o l·ªãch s·ª≠
                investmentHistory.unshift({
                    invoice: `#${invoice.id}`,
                    amount: parseFloat(amount),
                    apy: invoice.apy,
                    status: isVietnamese ? "ƒêang ho·∫°t ƒë·ªông" : "Active"
                });
                
                renderInvestmentHistory();
                document.body.style.cursor = 'default';
            }, 1000);
        }
    }

    // ==================== KH·ªûI T·∫†O ====================
    // Render marketplace khi trang load
    window.onload = function() {
        renderMarketplace();
        renderInvestmentHistory();
    };
</script>
</body>
</html>